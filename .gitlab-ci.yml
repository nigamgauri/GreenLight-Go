# GitLab CI/CD pipeline for GreenLight Go

stages:
  - build
  - test
  - security
  - deploy

variables:
  PYTHON_VERSION: "3.12"

before_script:
  - echo "Setting up environment..."
  - apt-get update -qy
  - apt-get install -y python3 python3-pip
  - pip install -r requirements.txt

build:
  stage: build
  script:
    - echo "âœ… Installing dependencies completed."
    - python --version
  artifacts:
    paths:
      - code/
    expire_in: 1 week

test:
  stage: test
  script:
    - echo "ðŸ§ª Running basic tests..."
    - python -m unittest discover -s code/tests -p "test_*.py"
  allow_failure: true

security_scan:
  stage: security
  script:
    - echo "ðŸ”’ Running Bandit security scan..."
    - pip install bandit
    - bandit -r code/
  allow_failure: true

deploy:
  stage: deploy
  script:
    - echo "ðŸš€ Deploying to AWS..."
    - bash deploy_to_aws.sh
  only:
    - main
